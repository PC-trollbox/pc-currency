const embeds = require("jsembeds");
const fs = require("fs");
module.exports = function(app, initParams) {
	if (initParams) {
		embeds.evalDriver = initParams.evalDriver || embeds.evalDriver;
		embeds.embedOpen = initParams.embedOpen || embeds.embedOpen;
		embeds.embedClose = initParams.embedClose || embeds.embedClose;
		embeds.exclusivePrefix = initParams.exclusivePrefix || embeds.exclusivePrefix;
	}
	app.engine("jsembeds", function(filePath, options, callback) {
		fs.readFile(filePath, function (err, content) {
			if (err) callback(err);
			callback(null, embeds.embed(content.toString(), JSON.parse(JSON.stringify(options))));
		});
	});
}